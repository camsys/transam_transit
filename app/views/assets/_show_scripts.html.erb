<script type="text/javascript">

  // Form Validations
  // override jquery validate plugin defaults
  $.validator.setDefaults({
      highlight: function(element) {
          $(element).closest('.form-group').addClass('has-error');
      },
      unhighlight: function(element) {
          $(element).closest('.form-group').removeClass('has-error');
      },
      errorElement: 'span',
      errorClass: 'help-block',
      errorPlacement: function(error, element) {
          if(element.parent('.input-group').length) {
              error.insertAfter(element.parent());
          } else {
              error.insertAfter(element);
          }
      }
  }); 
  
  var user_detail_tab_key = 'assets_detail_tab_key';
  var user_profile_tab_key = 'assets_profile_tab_key';
  $(document).ready(function() {
   // Manage the tabs
    $('a[data-toggle="tab"]').on('shown.bs.tab', function(e) {
      // save the last tab selected
      var this_tab = $(this).attr('href');
      if ($(this).attr('data-panel') == 'profile') {
        transam.set_ui_key_value(user_profile_tab_key, this_tab);
      } else {
	transam.set_ui_key_value(user_detail_tab_key, this_tab);
      }
      if (this_tab == '#map') {
        invalidateMap();
      } else if (this_tab == '#chrt') {
        if (condition_chart) {
          draw_condition_chart();         
        }
        if (mileage_chart) {
          draw_mileage_chart();
        }
      }
  });

  $(function() {
    [user_detail_tab_key, user_profile_tab_key].forEach(function(key) {
      var selected_tab = $('a[href="'+transam.get_ui_key_value(key)+'"]');
      // Default to first tab if no tab is stored or stored tab isn't available to current user
      if (selected_tab.length) {
	selected_tab.tab('show');
      } else {
	$('a[data-toggle="tab"]:first').tab('show');
      }
    });
  });
}); 
</script>


