%table.table.table-hover
  %thead
    %tr
      %th.left Category
      %th.left Class
      %th.left Type
      %th.left Sub Type
      %th.right Count
      %th.right Book Value
      %th.right Replacement Cost
  %tbody
    - sum_book_val = 0
    - sum_cost = 0
    - org_assets = assets.joins(:fta_asset_category, :fta_asset_class).joins('INNER JOIN fta_vehicle_types ON fta_vehicle_types.id = fta_type_id AND fta_type_type = "FtaVehicleType"').joins('INNER JOIN asset_subtypes ON asset_subtypes.id = transam_assets.asset_subtype_id')
    - org_assets.group('fta_asset_categories.name','fta_asset_classes.name','fta_vehicle_types.name', 'asset_subtypes.name').count.each do |k,v|
      %tr
        %td.left= k[0]
        %td.left= k[1]
        %td.left= k[2]
        %td.left= k[3]
        %td.right= format_as_integer(v)
        - book_val = org_assets.where(fta_vehicle_types: {name: k[2]}, asset_subtypes: {name: k[3]}).sum{ |a| a.book_value.to_i }
        - cost = org_assets.where(fta_vehicle_types: {name: k[2]}, asset_subtypes: {name: k[3]}).sum{ |a| a.scheduled_replacement_cost.to_i }
        - sum_book_val += book_val
        - sum_cost += cost
        %td.right= format_as_currency(book_val)
        %td.right= format_as_currency(cost)
  %tfoot
    %tr
      %td{colspan: 2}
      %td.left= "Totals"
      %td
      %td.right= format_as_integer(assets.count)
      %td.right= format_as_currency(sum_book_val)
      %td.right= format_as_currency(sum_cost)
