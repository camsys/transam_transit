.modal-dialog
  .modal-content
    .modal-header
      %button.close{:data => {:dismiss => "modal"}}
        x
      %h3.modal-title
        Tam Group
    .modal-body
      %fieldset
        %legend
          = @tam_group.new_record? ? 'Add Group' : 'Edit Group'
        = simple_form_for([@rule_set_type, @tam_policy, @tam_group],
          :html => {:class => 'form-vertical'},
          :wrapper => :vertical_form,
          :wrapper_mappings => {:check_boxes => :vertical_radio_and_checkboxes, :radio_buttons => :vertical_radio_and_checkboxes, :file => :vertical_file_input, :boolean => :vertical_boolean}) do |f|

          .row
            .col-sm-6
              = f.input :name
            .col-sm-6
              = f.input :leader_id, :label => "TAM Group Lead", :collection => TransitOperator.where(id: @organization_list), :group_label_method => 'coded_name', :as => :grouped_select, :group_method => :transit_managers
          = f.association :organizations, :collection => Organization.where(id: (@organization_list - @tam_policy.tam_groups.organization_ids)), :label_method => :coded_name, :required => true
          = f.association :fta_asset_categories, :as => :check_boxes, :collection => FtaAssetCategory.active, :label => 'Asset Categories'

          = f.submit 'Save', :class => 'btn btn-primary' #, :data => {:confirm => "Creating a new TAM policy year cannot be undone and Groups can no longer be added to the TAM policy from the prior year. Do you wish to proceed?"}
          %button.btn.btn-default{:data => {:dismiss => "modal"}} Cancel

:javascript

  var asset_types = JSON.parse('#{@asset_categories.to_json}');

  $('.form-vertical').validate({
    submitHandler: function(form) {
      form.submit();
    }
  });

  $( '#tam_group_organization_ids').change(function() {

    // hide all FTA asset categories
    $('span.checkbox').hide();

    org_ids = $(this).val();

    // Set asset types of org only
    for (var j = 0; j < org_ids.length; j++){
      org_types = asset_types[parseInt(org_ids[j])]
      for (var k = 0; k < org_types.length; k++){
        category_id = org_types[k];
        $('#tam_group_fta_asset_category_ids_'+category_id).parent().parent().show();
      }
    }

  });