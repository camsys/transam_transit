<script type="text/javascript">

  $(document).ready(function() {

    transam.enable_date_pickers();
    transam.make_same_height('.form_part');

      // Page Load Events
      $('#spinner').hide();
      $('.general-fields').hide();
      $('.all-asset-only').hide();
      $('.equipment-related-only').hide();
      $('.vehicle-related-only').hide();
      $('.facility-related-only').hide();
      $('.equipment-selector').hide();
      $('.revenue-vehicle-selector').hide();
      $('.support-vehicle-selector').hide();
      $('.railcar-selector').hide();
      $('.locomotive-selector').hide();
        // Add the class "All" to the first option in the Asset Selector
        // to ensure that the javascript can detect when a user has selected the the "Any . . ." option.
      $("#type-selector option:first").attr('class', 'All');

      // Search Form AJAX event handling // See https://github.com/rails/jquery-ujs/wiki/ajax
      $("form").on("ajax:send", function(xhr) {
        $('#results_table').hide();
        $('#spinner').show();
      })
      .on("ajax:success", function(xhr) {
        $(".search-panel").collapse('hide');
      })
      .on("ajax:complete", function(xhr, status) {
        $('#spinner').hide();
      });


      //Allows disabled form fields to submit as blank values, which is necessary to prevent the asset searcher from interpreting them as nil.
      $("form").submit(function(){
          $("input:disabled").removeAttr("disabled").prop('selected', false).val('');
        });

      // Type Selector Handler, Populates the Asset Search form and disables fields depending on what the user clicks chooses.
      $('#type-selector').on('click', function(event) {
        var selectedOptions = $('#type-selector option:selected');
        classNames = $.map(selectedOptions, function(option){
          return $(option).attr('class');
        });

        // These variables detect what types the user selected
        var selectedEquipment = ($.inArray("Equipment", classNames) !== -1);

        var selectedVehicles = ($.inArray("Vehicle", classNames) !== -1);
        var selectedSupportVehicles = ($.inArray("SupportVehicle", classNames) !== -1);

        var selectedRailCars = ($.inArray("RailCar", classNames) !== -1)
        var selectedLocomotives = ($.inArray("Locomotive", classNames) !== -1);

        var selectedTransitFacility = ($.inArray("TransitFacility", classNames) !== -1);
        var selectedSupportFacility = ($.inArray("SupportFacility", classNames) !== -1);

        var facilityFields = (selectedTransitFacility || selectedSupportFacility)
        var vehicleFields = (selectedVehicles || selectedSupportVehicles || selectedRailCars || selectedLocomotives);

        var onlyEquipment = (selectedEquipment && !vehicleFields && !facilityFields);
        var onlyVehicles = (vehicleFields && !selectedEquipment && !facilityFields);
        var onlyFacilities = (facilityFields && !vehicleFields && !selectedEquipment);

        var noTypeSpecified = (!selectedEquipment && !vehicleFields && !facilityFields);

        //Shows only the Subtypes Relevant to the Search
        if (selectedEquipment){
          $('.equipment-selector').fadeIn();
        }
        else{
          $('.equipment-selector').hide();
          $('.equipment-selector option').prop('selected', false);
          $('.equipment-selector input').val('');
        };

        if (selectedVehicles){
          $('.revenue-vehicle-selector').fadeIn();
        }
        else{
          $('.revenue-vehicle-selector').hide();
          $('.revenue-vehicle-selector option').prop('selected', false);
          $('.revenue-vehicle-selector input').val('');
        };

        if (selectedSupportVehicles){
          $('.support-vehicle-selector').fadeIn();
        }
        else{
          $('.support-vehicle-selector').hide();
          $('.support-vehicle-selector option').prop('selected', false);
          $('.support-vehicle-selector input').val('');
        };

        if (selectedRailCars){
          $('.railcar-selector').fadeIn();
        }
        else{
          $('.railcar-selector').hide();
          $('.railcar-selector option').prop('selected', false);
          $('.railcar-selector input').val('');
        };

        if (selectedLocomotives){
          $('.locomotive-selector').fadeIn();
        }
        else{
          $('.locomotive-selector').hide();
          $('.locomotive-selector option').prop('selected', false);
          $('.locomotive-selector input').val('');
        };


        // Shows or hides the fields depending on the selections
        if (classNames.length > 0){
          $('.general-fields').fadeIn();
        } else{
          $('.general-fields').hide();
        }

        if (onlyEquipment){
          $('.equipment-related-only').fadeIn();
        }
        else{
          $('.equipment-related-only').hide();
          $('.equipment-related-only option').prop('selected', false);
          $('.equipment-related-only input').val('');
        };

        if (onlyVehicles){
          $('.vehicle-related-only').fadeIn();
        }
         else{
          $('.vehicle-related-only').hide();
          $('.vehicle-related-only option').prop('selected', false);
          $('.vehicle-related-only input').val('');
        }

        if(onlyFacilities){
          $('.facility-related-only').fadeIn();
        } else{
          $('.facility-related-only').hide();
          $('.facility-related-only option').prop('selected', false);
          $('.facility-related-only input').val('');
        };

        if (noTypeSpecified)
          $('.all-asset-only').fadeIn();
        else{
          $('.all-asset-only').hide();
          $('.all-asset-only option').prop('selected', false);
          $('.all-asset-only input').val('');
        }

        // Reset all disabled form fields so that it can correctly
        // determine which fields to disable
        $(':input').removeAttr("disabled");

        // Disables form fields not relevant to the selected asset type(s)
        if (selectedRailCars){
          $('.not-for-railcars :input').attr("disabled", "disabled");
        }

        if (selectedLocomotives){
          $('.not-for-locomotives :input').attr("disabled", "disabled");
        }

        if (selectedTransitFacility){
          $('.not-for-transit :input').attr("disabled", "disabled");
        }

        if (selectedSupportFacility){
          $('.not-for-support-facility :input').attr("disabled", "disabled");
        }

        if (selectedSupportVehicles){
          $('.not-for-support-vehicles :input').attr("disabled", "disabled");
        }

      });
  });

</script>
